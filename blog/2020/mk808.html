<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Afonso Raposo | Running Debian Linux on MK808 Android Mini TV</title>
<meta name="description" content="Personal website.
">

<!-- Open Graph -->

<meta property="og:site_name" content="Personal website.
" />
<meta property="og:type" content="object" />
<meta property="og:title" content="" />
<meta property="og:url" content="https://afonsoraposo.com/blog/2020/mk808" />
<meta property="og:description" content="Running Debian Linux on MK808 Android Mini TV" />
<meta property="og:image" content="https://github.com/Afonsocraposo/afonsocraposo.github.io/raw/master/assets/img/coding.jpg" />


<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" integrity="sha512-RO38pBRxYH3SoOprtPTD86JFOclM51/XTIdEPh5j8sj4tp8jmQIx26twG52UaLi//hQldfrh7e51WzP9wuP32Q==" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

<!-- Code Syntax Highlighting -->
<link rel="stylesheet" href="https://gitcdn.link/repo/jwarby/jekyll-pygments-themes/master/github.css" />

<!-- Styles -->

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üë®üèª‚Äçüíª</text></svg>">

<link rel="stylesheet" href="/assets/css/main.css">

<link rel="canonical" href="/blog/2020/mk808">

<!-- JQuery -->
<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>


<!-- Theming-->

  <script src="/assets/js/theme.js"></script>
  <!-- Load DarkMode JS -->
<script src="/assets/js/dark_mode.js"></script>






    
<!-- MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>
<script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js"></script>
<script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


  </head>

  <body class="fixed-top-nav sticky-bottom-footer">

    <!-- Header -->

    <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
    <div class="container">
      
      <a class="navbar-brand title font-weight-lighter" href="https://afonsoraposo.com/">
       Afonso Raposo
      </a>
      
      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">
              About
              
            </a>
          </li>
          
          <!-- Blog -->
          <li class="nav-item active">
            <a class="nav-link" href="/blog/">
              Blog
              
            </a>
          </li>
          
          <!-- Other pages -->
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/projects/">
                Projects
                
              </a>
          </li>
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/publications/">
                Publications
                
              </a>
          </li>
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/teaching/">
                Teaching
                
              </a>
          </li>
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/assets/pdf/CV_Afonso_Raposo.pdf">
                cv
                
              </a>
          </li>
          
          
          
            <div class = "toggle-container">
              <a id = "light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
              </a>
            </div>
          
        </ul>
      </div>
    </div>
  </nav>

</header>


    <!-- Content -->

    <div class="container mt-5">
      

<div class="post">

  <header class="post-header">
    <h1 class="post-title">Running Debian Linux on MK808 Android Mini TV</h1>
    <p class="post-meta">May 16, 2020</p>
  </header>

  <article class="post-content">
    <div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/posts/2020-05-16-mk808/setup.jpeg" />
    </div>
</div>
<div class="caption">
    My setup on the last days during this journey and the device itself.
</div>

<p>Many years ago, I acquired this device, the MK808 Android Mini TV. This device natively runs Android and its made for streaming content on a TV via Mini HDMI port. This device has 8GB NAND Flash, a CPU Dual Core Cortex-A9 Up to 1.6GHz (Rochip RK 3066), and 1GB of RAM.</p>

<p>In the last years, I‚Äôve started using Linux. I‚Äôm no professional, but I love it. Some days ago, I decided to see if this old device I had laying around could run Linux. It runs Android, that‚Äôs a good sign.</p>

<p>After searching and reading a lot of 2010‚Äì2013 forum posts, I was able to figure out how to do it. I‚Äôll list the main sources of information I used:</p>
<ul>
  <li><a href="http://cobecoballes-embedded.blogspot.com/2013/08/writing-image-from-mk808rk3066-in-linux.html">Writing Image and booting Linux from MK808/RK3066</a></li>
  <li><a href="https://www.slatedroid.com/topic/55626-my-version-of-the-linux-kernel-for-mk808/"><em>(unavailable)</em> My version of the Linux kernel for mk808 - MK808</a></li>
</ul>

<p>I‚Äôm not claiming that this is the best way of doing this process, because it probably isn‚Äôt. The objective of this is to share my journey and maybe help someone who wants to do this.</p>

<h4 id="disclaimer-i-cant-give-you-a-warranty-that-this-will-work-on-your-device-and-i-wont-be-held-responsible-for-any-damage-to-your-device"><em><b>DISCLAIMER:</b> I can‚Äôt give you a warranty that this will work on your device and I won‚Äôt be held responsible for any damage to your device.</em></h4>

<center>
<h1>
. . .
</h1>
</center>

<p>The first step was flashing a new kernel to the device. The kernel I used was compiled by Oleg, who did serious work on this subject. You can find his GitHub <a href="https://github.com/olegk0">here</a>.</p>

<p>You can download the already compiled kernel on his <a href="https://drive.google.com/drive/u/0/folders/0B6QRwjacGTzCU3RWZ1M2d1FkcTg">Google Drive</a>.</p>

<p>I made a <strong>backup</strong> of the files on my personal <a href="https://drive.google.com/drive/folders/1_otAwk9GmgpxaDkDGse6-B-uQcrXF99K?usp=sharing">Drive</a></p>

<p>Download the <code class="language-plaintext highlighter-rouge">recovery.img</code> and <code class="language-plaintext highlighter-rouge">mod+fw.tar.gz</code> files from the folder 30.36 (kernel version). I used this kernel because it supports 1080p and was the one that I was able to get the wifi dongle driver working.</p>

<p>Now onto flashing the kernel to the device. I did this in Linux, so I‚Äôll explain the procedure on this platform. We need to boot into recovery mode. To do so, press the reset hole, connect the mini USB cable to the OTG port, hold for around 5 seconds and it should be all good.</p>

<p>Run the command on the terminal:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lsusb
</code></pre></div></div>

<p>And the device should appear:</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/posts/2020-05-16-mk808/lsusb.png" />
    </div>
</div>
<div class="caption">
    Result of lsusb and the device highlighted.
</div>

<p>Register the device ID, on my case: <code class="language-plaintext highlighter-rouge">2207:300a</code>.</p>

<p>Now, the software used to flash the kernel was downloaded from <a href="https://github.com/justgr/arnova-tools">justgr/arnova-tools</a>.</p>

<p>Before compiling, you need to add a line to the code of <code class="language-plaintext highlighter-rouge">rkflashtool.c</code> with your <strong>device ID</strong>:</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/posts/2020-05-16-mk808/code.png" />
    </div>
</div>
<div class="caption">
    Source code of rkflashtool.c and the snippet of code to add.
</div>

<p>You can now compile it using the command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc -o rkflashtool rkflashtool.c -lusb-1.0 -O2 -W -Wall -s
</code></pre></div></div>

<p>Now, let‚Äôs flash the kernel!</p>

<p>First, backup the 8GB NAND flash by dumping its contents into a file. Run the command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo rkflashtool r 0x00000000 0x01000000 &gt; myflashbackup.bin
</code></pre></div></div>

<p>You can also backup the current kernel:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo rkflashtool r 0x00004000 0x00004000 &gt; mk808kernel.img
</code></pre></div></div>

<p>To flash the downloaded kernel, 3.0.36 from Oleg:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo rkflashtool w 0x00004000 0x00004000 &lt; recovery.img
</code></pre></div></div>

<p>When this finishes, you should have the kernel on your device. Connect everything back and turn on the device!</p>

<p>If you see these two penguins, everything went well:</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/posts/2020-05-16-mk808/linux.jpeg" />
    </div>
</div>
<div class="caption">
    Linux kernel booting screen.
</div>

<center>
<h1>
. . .
</h1>
</center>

<p>The next step is preparing the SD card for installing Linux on it.</p>

<p>On the guides I found, they say to format the SD card with <code class="language-plaintext highlighter-rouge">ext4</code>. I wasn‚Äôt able to get this format working, because I got the error:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/dev/‚Ä¶ has unsupported feature(s): metadata_csum
e2fsck: Get a newer version of e2fsck!
</code></pre></div></div>

<p>After googling it, I was able to figure out that the problem was caused by the version of e2fsck not being able to process the <code class="language-plaintext highlighter-rouge">ext4</code> SD card. Therefore, I format it with <code class="language-plaintext highlighter-rouge">ext2</code>, which will also help with the number of events of read/write of the SD card.</p>

<p>To format the SD card, run the command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo mkfs.ext2 /dev/sdg1 -L linuxroot
</code></pre></div></div>

<p><strong>Replace</strong> the <code class="language-plaintext highlighter-rouge">sdg1</code> by the name of the SD card on your computer. Notice that I labeled the partition with <code class="language-plaintext highlighter-rouge">linuxroot</code>, which is a requirement for the kernel.</p>

<p>After formatting the SD card, it‚Äôs time to create a rootfs on the SD card. I‚Äôll use Debian because it is compatible and makes this process very easy. Mount the SD card, by doing:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo mount /dev/sdg1 /mnt/tmp
</code></pre></div></div>

<p>And then run the command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo debootstrap --foreign --verbose --arch=armhf jessie /mnt/tmp
</code></pre></div></div>

<p>When it finishes, you have to copy the <code class="language-plaintext highlighter-rouge">modules</code> and <code class="language-plaintext highlighter-rouge">firmware</code> to the rootfs. Make sure you extract the folder using <strong>sudo</strong>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo tar -zxvf mod+fw.tar.gz
</code></pre></div></div>

<p>Then, copy the folders <code class="language-plaintext highlighter-rouge">firmware</code> and <code class="language-plaintext highlighter-rouge">modules</code> to <code class="language-plaintext highlighter-rouge">/mnt/tmp/lib</code>.</p>

<p>You will also need to edit the <code class="language-plaintext highlighter-rouge">/etc/fstab</code> file so the system mounts the rootfs. Your <code class="language-plaintext highlighter-rouge">/etc/fstab</code> file should look like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># &lt;file system&gt;                                 &lt;dir&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;
UUID=8c2995cd-60e8-4537-867e-f15083bf7442       /       ext2    defaults        1       1
</code></pre></div></div>

<p><strong>Replace</strong> the UUID with your SD card UUID. You can find it by running the command on your computer (outside the rootfs):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls /dev/disk/by-uuid -l
</code></pre></div></div>

<p>Now, it‚Äôs time to setup the freshly installed OS. First <code class="language-plaintext highlighter-rouge">chroot</code> into the directory:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo chroot /mnt/tmp
</code></pre></div></div>

<p>Now that you are inside the generated rootfs, change the root password:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>passwd
</code></pre></div></div>

<p>Then, setup your account - select your username and your password which will be prompted:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>adduser [username]
</code></pre></div></div>

<p>Now add your account to <code class="language-plaintext highlighter-rouge">sudoers</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>addgroup [username] sudo
</code></pre></div></div>

<p>You now have your own account!</p>

<p>You won‚Äôt have internet on your device when you boot it, so, we should now setup everything necessary.</p>

<p>Add the <code class="language-plaintext highlighter-rouge">non-free</code> and <code class="language-plaintext highlighter-rouge">contrib</code> repositories to the <code class="language-plaintext highlighter-rouge">/etc/apt/sources.list</code> file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>deb http://deb.debian.org/debian jessie main contrib non-free
deb-src http://deb.debian.org/debian jessie main contrib non-free
</code></pre></div></div>

<p>Then, update the repositories and upgrade the packages:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt update &amp;&amp; apt upgrade
</code></pre></div></div>

<p>I advise you to install the following packages:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt install firmware-misc-nonfree firmware-atheros firmware-ralink
</code></pre></div></div>

<p>This will install some firmware and, if you‚Äôre lucky, your wifi dongle will work when plugged.</p>

<p>Mine didn‚Äôt. I have a WN722N and I had to install the drivers from the <a href="https://www.tp-link.com/pt/support/download/tl-wn722n/">official website</a> (I‚Äôm not sure if this was what did it, I spent a lot of hours trying to make it work):</p>

<p>You should now have the device working with Debian 8 Jessie and with a connection to the internet.</p>

<p>Once you boot into the device, run the command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo depmod
</code></pre></div></div>

<p>This will create a list of module dependencies by reading each module and clear the errors on the booting screen.</p>

<center>
<h1>
. . .
</h1>
</center>
<p><br /></p>

<p>If you prefer to have a Desktop Environment, you can easily do it by installing XFCE4 and a display manager Lightdm:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt install xfce4 lightdm
</code></pre></div></div>

<p>Now, when you turn on your device, you‚Äôll be greeted with the Lightdm screen and you can login into your device.</p>

<p>I also advise you to install a network manager:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt install network-manager-gnome
</code></pre></div></div>

<p>You‚Äôll notice that the clock time isn‚Äôt correct, you need to install NTP:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt install ntp
</code></pre></div></div>

<p>You may also need to configure your timezone and locale:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dpkg-reconfigure tzdata
apt install locales
dpkg-reconfigure locales
</code></pre></div></div>

<p>And that‚Äôs it. I think I explained everything. When you‚Äôre done, you‚Äôll have a tiny device running Debian 8 with XFCE and internet support.</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/posts/2020-05-16-mk808/debian.png" />
    </div>
</div>
<div class="caption">
    Neofetch output of the device running Debian Jessie with XFCE.
</div>
<p><br /></p>

  </article>

  
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname  = 'afonso';
      var disqus_identifier = '/blog/2020/mk808';
      var disqus_title      = "Running Debian Linux on MK808 Android Mini TV";
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  

</div>

    </div>

    <!-- Footer -->

    
<footer class="sticky-bottom mt-5">
  <div class="container">
    &copy; Copyright 2022 Afonso  Raposo.
    Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>.

    
    
    Last updated: October 17, 2022.
    
  </div>
</footer>



  </body>

  <!-- Bootsrap & MDB scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js" integrity="sha512-eUQ9hGdLjBjY3F41CScH3UX+4JDSI9zXeroz7hJ+RteoCaY+GP/LDoM8AO+Pt+DRFw3nXqsjh9Zsts8hnYv8/A==" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha512-M5KW3ztuIICmVIhjSqXe01oV2bpe248gOxqmlcYrEzAvws7Pw3z6BK0iGbrwvdrUQUhi3eXgtxp5I8PDo9YfjQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js" integrity="sha512-Mug9KHKmroQFMLm93zGrjhibM2z2Obg9l6qFG2qKjXEXkMp/VDkI4uju9m4QKPjWSwQ6O2qzZEnJDEeCw0Blcw==" crossorigin="anonymous"></script>

  
<!-- Mansory & imagesLoaded -->
<script defer src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script defer src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script defer src="/assets/js/mansory.js" type="text/javascript"></script>


  


<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>


</html>
